!function(r){var i={};function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=r,n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(i,n,a){(function(F){var e,t,r;function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r=function(){"use strict";var e="undefined"!=typeof window?window:void 0!==F?F:"undefined"!=typeof self?self:{};var t="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},n=function(e){var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)},r=Object.prototype.toString;var i,o=(function(e,t){(t=e.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}}(i={exports:{}},i.exports),i.exports),s=function(e,t,r){if(!n(t))throw new TypeError("iterator must be a function");arguments.length<3&&(r=this);"[object Array]"===a.call(e)?function(e,t,r){for(var i=0,n=e.length;i<n;i++)u.call(e,i)&&t.call(r,e[i],i,e)}(e,t,r):"string"==typeof e?function(e,t,r){for(var i=0,n=e.length;i<n;i++)t.call(r,e.charAt(i),i,e)}(e,t,r):function(e,t,r){for(var i in e)u.call(e,i)&&t.call(r,e[i],i,e)}(e,t,r)},a=Object.prototype.toString,u=Object.prototype.hasOwnProperty;var m=function(e){if(!e)return{};var a={};return s(o(e).split("\n"),function(e){var t,r=e.indexOf(":"),i=o(e.slice(0,r)).toLowerCase(),n=o(e.slice(r+1));void 0===a[i]?a[i]=n:(t=a[i],"[object Array]"===Object.prototype.toString.call(t)?a[i].push(n):a[i]=[a[i],n])}),a},l=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)h.call(r,i)&&(e[i]=r[i])}return e},h=Object.prototype.hasOwnProperty;var g=p,f=p;function c(e,t,r){var i=e;return n(t)?(r=t,"string"==typeof e&&(i={uri:e})):i=l(t,{uri:e}),i.callback=r,i}function p(e,t,r){return d(t=c(e,t,r))}function d(i){if(void 0===i.callback)throw new Error("callback argument missing");var n=!1,a=function(e,t,r){n||(n=!0,i.callback(e,t,r))};function t(e){return clearTimeout(u),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,a(e,v)}function e(){if(!o){var e;clearTimeout(u),e=i.useXDR&&void 0===s.status?200:1223===s.status?204:s.status;var t=v,r=null;return 0!==e?(t={body:function(){var e=void 0;if(e=s.response?s.response:s.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(s),g)try{e=JSON.parse(e)}catch(e){}return e}(),statusCode:e,method:h,headers:{},url:l,rawRequest:s},s.getAllResponseHeaders&&(t.headers=m(s.getAllResponseHeaders()))):r=new Error("Internal XMLHttpRequest Error"),a(r,t,t.body||t.rawRequest.response)}}var r,o,s=i.xhr||null;s||(s=i.cors||i.useXDR?new p.XDomainRequest:new p.XMLHttpRequest);var u,l=s.url=i.uri||i.url,h=s.method=i.method||"GET",f=i.body||i.data,c=s.headers=i.headers||{},d=!!i.sync,g=!1,v={body:void 0,headers:{},statusCode:0,method:h,url:l,rawRequest:s};if("json"in i&&!1!==i.json&&(g=!0,c.accept||c.Accept||(c.Accept="application/json"),"GET"!==h&&"HEAD"!==h&&(c["content-type"]||c["Content-Type"]||(c["Content-Type"]="application/json"),f=JSON.stringify(!0===i.json?f:i.json))),s.onreadystatechange=function(){4===s.readyState&&setTimeout(e,0)},s.onload=e,s.onerror=t,s.onprogress=function(){},s.onabort=function(){o=!0},s.ontimeout=t,s.open(h,l,!d,i.username,i.password),d||(s.withCredentials=!!i.withCredentials),!d&&0<i.timeout&&(u=setTimeout(function(){if(!o){o=!0,s.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",t(e)}},i.timeout)),s.setRequestHeader)for(r in c)c.hasOwnProperty(r)&&s.setRequestHeader(r,c[r]);else if(i.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(i.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in i&&(s.responseType=i.responseType),"beforeSend"in i&&"function"==typeof i.beforeSend&&i.beforeSend(s),s.send(f||null),s}p.XMLHttpRequest=t.XMLHttpRequest||function(){},p.XDomainRequest="withCredentials"in new p.XMLHttpRequest?p.XMLHttpRequest:t.XDomainRequest,function(e,t){for(var r=0;r<e.length;r++)t(e[r])}(["get","put","post","patch","head","delete"],function(i){p["delete"===i?"del":i]=function(e,t,r){return(t=c(e,t,r)).method=i.toUpperCase(),d(t)}}),g.default=f;var v="function"==typeof Symbol&&"symbol"===M(Symbol.iterator)?function(e){return M(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":M(e)},E=(function(){function l(e){this.value=e}function e(n){var a,o;function s(e,t){try{var r=n[e](t),i=r.value;i instanceof l?Promise.resolve(i.value).then(function(e){s("next",e)},function(e){s("throw",e)}):u(r.done?"return":"normal",r.value)}catch(e){u("throw",e)}}function u(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}(a=a.next)?s(a.key,a.arg):o=null}this._invoke=function(i,n){return new Promise(function(e,t){var r={key:i,arg:n,resolve:e,reject:t,next:null};o?o=o.next=r:(a=o=r,s(i,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(e){return this._invoke("next",e)},e.prototype.throw=function(e){return this._invoke("throw",e)},e.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),T=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),y=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},R="";var b='\n\tThis page requires a browser that supports WebGL.<br/>\n\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>\n',_='\n\tIt does not appear your computer can support WebGL.<br/>\n\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>\n',x=1,A=2;function w(n,e,a){function t(e,t){var r,i;"function"==typeof a?a(e):(r=t,(i=n.parentNode)&&(i.innerHTML='\n<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>\n<td align="center">\n<div style="display: table-cell; vertical-align: middle;">\n<div style="">'+r+"</div>\n</div>\n</td></tr></table>\n"))}if(!window.WebGLRenderingContext)return t(x,b),null;var r=function(e,t){for(var r=["webgl","experimental-webgl"],i=null,n=0;n<r.length;++n)try{i=e.getContext(r[n],t)}catch(e){if(i)break}return i}(n,e);return r?r.getExtension("OES_standard_derivatives"):t(A,_),r}function S(e,t,r,i){var n=e.gl,a=n.createShader(r);return n.shaderSource(a,t),n.compileShader(a),n.getShaderParameter(a,n.COMPILE_STATUS)?a:(R=n.getShaderInfoLog(a),console.error("*** Error compiling shader "+a+":"+R),e.trigger("error",{shader:a,source:t,type:r,error:R,offset:i||0}),n.deleteShader(a),null)}function U(e,t,r,i){for(var n=e.gl,a=n.createProgram(),o=0;o<t.length;++o)n.attachShader(a,t[o]);if(r)for(var s=0;s<r.length;++s)n.bindAttribLocation(a,i?i[s]:s,r[s]);return n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)?a:(R=n.getProgramInfoLog(a),console.log("Error in program linking:"+R),n.deleteProgram(a),null)}function P(e){return 0==(e&e-1)}function L(e){var g=new Set;return Object.assign(e,{on:function(e,t){var r={};r[e]=t,g.add(r)},off:function(e,t){if(t){var r={};r[e]=t,g.delete(r)}else{var i=!0,n=!1,a=void 0;try{for(var o,s=g[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value,l=!0,h=!1,f=void 0;try{for(var c,d=Object.keys(u)[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){if(c.value===e)return void g.delete(u)}}catch(e){h=!0,f=e}finally{try{!l&&d.return&&d.return()}finally{if(h)throw f}}}}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}}},listSubscriptions:function(){var e=!0,t=!1,r=void 0;try{for(var i,n=g[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var a=i.value;console.log(a)}}catch(e){t=!0,r=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw r}}},subscribe:function(e){g.add(e)},unsubscribe:function(e){g.delete(e)},unsubscribeAll:function(){g.clear()},trigger:function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var n=!0,a=!1,o=void 0;try{for(var s,u=g[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value;"function"==typeof l[e]&&l[e].apply(l,y(r))}}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}}})}var X=function(){function i(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};E(this,i),L(this),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=t,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(r.filtering),this.load(r)}return T(i,[{key:"destroy",value:function(){this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(e){this.valid&&("number"==typeof e&&i.activeUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),i.activeUnit=e),i.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),i.activeTexture=this.texture))}},{key:"load",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.loading=null,"string"==typeof e.url?void 0!==this.url&&e.url===this.url||this.setUrl(e.url,e):e.element?this.setElement(e.element,e):e.data&&e.width&&e.height&&this.setData(e.width,e.height,e.data,e)}},{key:"setUrl",value:function(a){var o=this,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.valid)return this.url=a,this.source=this.url,this.sourceType="url",this.loading=new Promise(function(t,e){var r=a.split(".").pop().toLowerCase(),i="ogv"===r||"webm"===r||"mp4"===r,n=void 0;i?((n=document.createElement("video")).autoplay=!0,s.filtering="nearest"):n=new Image,n.onload=function(){try{o.setElement(n,s)}catch(e){console.log("Texture '"+o.name+"': failed to load url: '"+o.source+"'",e,s)}t(o)},n.onerror=function(e){console.log("Texture '"+o.name+"': failed to load url: '"+o.source+"'",e,s),t(o)},/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&"data:"===o.source.slice(0,5)||(n.crossOrigin="anonymous"),n.src=o.source,i&&o.setElement(n,s)}),this.loading}},{key:"setData",value:function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return this.width=e,this.height=t,this.source=r,this.sourceType="data",this.update(i),this.setFiltering(i),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(e,t){var r=this,i=e;if("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement)this.source=e,this.sourceType="element",e instanceof HTMLVideoElement?(e.addEventListener("canplaythrough",function(){r.intervalID=setInterval(function(){r.update(t)},15)},!0),e.addEventListener("ended",function(){e.currentTime=0,e.play()},!0)):this.update(t),this.setFiltering(t);else{var n="the 'element' parameter (`element: "+JSON.stringify(i)+"`) must be a CSS ";n+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+n,t)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==e.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),"element"===this.sourceType&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):"data"===this.sourceType&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){this.powerOf2=P(this.width)&&P(this.height);var t=this.powerOf2?"mipmap":"linear";this.filtering=e.filtering||t;var r=this.gl;this.bind(),this.powerOf2?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.MIRRORED_REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.MIRRORED_REPEAT),"mipmap"===this.filtering?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.generateMipmap(r.TEXTURE_2D)):"linear"===this.filtering?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):"nearest"===this.filtering&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST))):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),"mipmap"===this.filtering&&(this.filtering="linear"),"nearest"===this.filtering?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)))}}}]),i}();X.getMaxTextureSize=function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)},X.activeUnit=-1;var D=function(){function d(e,t,r){var i=this;E(this,d),L(this),t=t||{},r=r||{},this.width=e.clientWidth,this.height=e.clientHeight,this.canvas=e,this.gl=void 0,this.program=void 0,this.textures={},this.buffers={},this.uniforms={},this.vbo={},this.isValid=!1,this.BUFFER_COUNT=0,this.vertexString=t.vertexString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",this.fragmentString=t.fragmentString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n    gl_FragColor = vec4(0.0);\n}\n";var n=w(e,t,r.onError);if(n){if(this.gl=n,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,this.realToCSSPixels=window.devicePixelRatio||1,e.style.backgroundColor=t.backgroundColor||"rgba(1,1,1,0)",e.hasAttribute("data-fragment"))this.fragmentString=e.getAttribute("data-fragment");else if(e.hasAttribute("data-fragment-url")){var a=e.getAttribute("data-fragment-url");g.get(a,function(e,t,r){i.load(r,i.vertexString)})}if(e.hasAttribute("data-vertex"))this.vertexString=e.getAttribute("data-vertex");else if(e.hasAttribute("data-vertex-url")){var o=e.getAttribute("data-vertex-url");g.get(o,function(e,t,r){i.load(i.fragmentString,r)})}if(this.load(),this.program){var s=n.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=n.createBuffer(),this.gl.bindBuffer(n.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,n.FLOAT,!1,0,0);var u=n.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=n.createBuffer(),this.gl.bindBuffer(n.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n.STATIC_DRAW),this.gl.enableVertexAttribArray(u),this.gl.vertexAttribPointer(u,2,n.FLOAT,!1,0,0),e.hasAttribute("data-textures")){var l=e.getAttribute("data-textures").split(",");for(var h in l)this.setUniform("u_tex"+h,l[h])}var f={x:0,y:0};document.addEventListener("mousemove",function(e){f.x=e.clientX||e.pageX,f.y=e.clientY||e.pageY},!1);var c=this;return this.setMouse({x:0,y:0}),function e(){1<c.nMouse&&c.setMouse(f),c.resize()&&(c.forceRender=!0),c.render(),window.requestAnimationFrame(e)}(),this}}}return T(d,[{key:"destroy",value:function(){for(var e in this.animated=!1,this.isValid=!1,this.textures)e.destroy&&e.destroy();for(var t in this.textures={},this.attribs)this.gl.deleteBuffer(this.attribs[t]);for(var r in this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.buffers){var i=this.buffers[r];this.gl.deleteProgram(i.program)}this.program=null,this.gl=null}},{key:"load",value:function(e,t){if(t&&(this.vertexString=t),e&&(this.fragmentString=e),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=1<this.nDate||1<this.nTime||1<this.nMouse,this.fragmentString.search(/sampler2D/g))for(var r=this.fragmentString.split("\n"),i=0;i<r.length;i++){var n=r[i].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(n){var a=n[2].split(".").pop().toLowerCase();n[1]&&n[2]&&("jpg"===a||"jpeg"===a||"png"===a||"ogv"===a||"webm"===a||"mp4"===a)&&this.setUniform(n[1],n[2])}if(r[i].match(/\s*void\s*main\s*/g))break}var o=S(this,this.vertexString,this.gl.VERTEX_SHADER),s=S(this,this.fragmentString,this.gl.FRAGMENT_SHADER);this.isValid=!!s||(s=S(this,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",this.gl.FRAGMENT_SHADER),!1);var u=U(this,[o,s]);this.gl.useProgram(u),this.gl.deleteShader(o),this.gl.deleteShader(s),this.program=u,this.change=!0,this.BUFFER_COUNT=0;var l=this.getBuffers(this.fragmentString);Object.keys(l).length&&this.loadPrograms(l),this.buffers=l,this.texureIndex=this.BUFFER_COUNT,this.trigger("load",{}),this.forceRender=!0,this.render()}},{key:"test",value:function(n,a,o){var s=this.vertexString,u=this.fragmentString,l=this.paused,h=this.gl.getExtension("EXT_disjoint_timer_query"),f=h.createQueryEXT(),c=this.isValid;(a||o)&&(this.load(a,o),c=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,h.beginQueryEXT(h.TIME_ELAPSED_EXT,f),this.forceRender=!0,this.render(),h.endQueryEXT(h.TIME_ELAPSED_EXT);var d=this;!function e(){d.forceRender=!0,d.render();var t=h.getQueryObjectEXT(f,h.QUERY_RESULT_AVAILABLE_EXT),r=d.gl.getParameter(h.GPU_DISJOINT_EXT);if(t&&!r){var i={wasValid:c,frag:a||d.fragmentString,vert:o||d.vertexString,timeElapsedMs:h.getQueryObjectEXT(f,h.QUERY_RESULT_EXT)/1e6};d.paused=l,(a||o)&&d.load(u,s),n(i)}else window.requestAnimationFrame(e)}()}},{key:"loadTexture",value:function(e,t,r){var i=this;r||(r={}),"string"==typeof t?r.url=t:"object"===(void 0===t?"undefined":v(t))&&t.data&&t.width&&t.height?(r.data=t.data,r.width=t.width,r.height=t.height):"object"===(void 0===t?"undefined":v(t))&&(r.element=t),this.textures[e]?this.textures[e]&&(this.textures[e].load(r),this.textures[e].on("loaded",function(e){i.forceRender=!0})):(this.textures[e]=new X(this.gl,e,r),this.textures[e].on("loaded",function(e){i.forceRender=!0}))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(e){for(var t={},r=arguments.length,i=Array(1<r?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];t[e]=i,this.setUniforms(t)}},{key:"setUniforms",value:function(e){var t=function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=[];for(var n in t){var a=t[n],o=void 0;if(r&&(n=r+"."+n),"number"==typeof a)i.push({type:"float",method:"1f",name:n,value:a});else if(Array.isArray(a)){if("number"==typeof a[0])1===a.length?i.push({type:"float",method:"1f",name:n,value:a}):2<=a.length&&a.length<=4?i.push({type:"vec"+a.length,method:a.length+"fv",name:n,value:a}):4<a.length&&i.push({type:"float[]",method:"1fv",name:n+"[0]",value:a});else if("string"==typeof a[0])i.push({type:"sampler2D",method:"1i",name:n,value:a});else if(Array.isArray(a[0])&&"number"==typeof a[0][0]){if(2<=a[0].length&&a[0].length<=4)for(o=0;o<a.length;o++)i.push({type:"vec"+a[0].length,method:a[o].length+"fv",name:n+"["+o+"]",value:a[o]})}else if("object"===v(a[0]))for(o=0;o<a.length;o++)i.push.apply(i,y(e(a[o],n+"["+o+"]")))}else"boolean"==typeof a?i.push({type:"bool",method:"1i",name:n,value:a}):"string"==typeof a?i.push({type:"sampler2D",method:"1i",name:n,value:a}):"object"===(void 0===a?"undefined":v(a))&&i.push.apply(i,y(e(a,n)))}return i}(e);for(var r in t)"sampler2D"===t[r].type?this.loadTexture(t[r].name,t[r].value[0]):this.uniform(t[r].method,t[r].type,t[r].name,t[r].value);this.forceRender=!0}},{key:"setMouse",value:function(e){var t=this.canvas.getBoundingClientRect();if(e&&e.x&&e.x>=t.left&&e.x<=t.right&&e.y&&e.y>=t.top&&e.y<=t.bottom){var r=(e.x-t.left)*this.realToCSSPixels,i=this.canvas.height-(e.y-t.top)*this.realToCSSPixels;this.uniform("2f","vec2","u_mouse",r,i)}}},{key:"uniform",value:function(e,t,r){this.uniforms[r]=this.uniforms[r]||{};for(var i=this.uniforms[r],n=arguments.length,a=Array(3<n?n-3:0),o=3;o<n;o++)a[o-3]=arguments[o];var s,u;if((s=i.value,u=a,!(!s||!u)&&s.toString()!==u.toString())||this.change||!i.location||!i.value)for(var l in i.name=r,i.type=t,i.value=a,i.method="uniform"+e,this.gl.useProgram(this.program),i.location=this.gl.getUniformLocation(this.program,r),this.gl[i.method].apply(this.gl,[i.location].concat(i.value)),this.buffers){var h=this.buffers[l];this.gl.useProgram(h.program);var f=this.gl.getUniformLocation(h.program,r);this.gl[i.method].apply(this.gl,[f].concat(i.value))}}},{key:"uniformTexture",value:function(e,t,r){if(void 0===this.textures[e])this.loadTexture(e,t,r);else{for(var i in this.uniform("1i","sampler2D",e,this.texureIndex),this.buffers){var n=this.buffers[i];this.gl.useProgram(n.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[e].texture)}this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[e].texture),this.uniform("2f","vec2",e+"Resolution",this.textures[e].width,this.textures[e].height)}}},{key:"resize",value:function(){if(this.width===this.canvas.clientWidth&&this.height===this.canvas.clientHeight)return!1;this.realToCSSPixels=window.devicePixelRatio||1;var e=Math.floor(this.gl.canvas.clientWidth*this.realToCSSPixels),t=Math.floor(this.gl.canvas.clientHeight*this.realToCSSPixels);return this.gl.canvas.width===e&&this.gl.canvas.height===t||(this.gl.canvas.width=e,this.gl.canvas.height=t,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.resizeSwappableBuffers(),!0}},{key:"render",value:function(){var e;if(this.visible=0<(e=this.canvas).getBoundingClientRect().top+e.height&&e.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight),this.forceRender||this.change||this.animated&&this.visible&&!this.paused){var t=new Date,r=performance.now();for(var i in this.timeDelta=(r-this.timePrev)/1e3,this.timePrev=r,1<this.nDelta&&this.uniform("1f","float","u_delta",this.timeDelta),1<this.nTime&&this.uniform("1f","float","u_time",(r-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),3600*t.getHours()+60*t.getMinutes()+t.getSeconds()+.001*t.getMilliseconds()),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height),this.buffers){var n=this.buffers[i];this.uniform("1i","sampler2D",n.name,n.bundle.input.index)}for(var a in this.texureIndex=this.BUFFER_COUNT,this.textures)this.uniformTexture(a),this.texureIndex++;this.renderPrograms(),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"renderPrograms",value:function(){var e=this.gl,t=e.canvas.width,r=e.canvas.height;for(var i in e.viewport(0,0,t,r),this.buffers){var n=this.buffers[i];n.bundle.render(t,r,n.program,n.name),e.bindFramebuffer(e.FRAMEBUFFER,null)}e.useProgram(this.program),e.drawArrays(e.TRIANGLES,0,6)}},{key:"getBuffers",value:function(t){var r={};return t&&t.replace(/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm,function(){var e=arguments[3]||arguments[4];r["u_buffer"+e]={fragment:"#define BUFFER_"+e+"\n"+t}}),r}},{key:"loadPrograms",value:function(e){var t=this,r=this.gl,i=S(t,t.vertexString,r.VERTEX_SHADER);for(var n in e){var a=e[n],o=S(t,a.fragment,r.FRAGMENT_SHADER,1);t.isValid=!!o||(o=S(t,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",r.FRAGMENT_SHADER),!1);var s=U(t,[i,o]);a.name=n,a.program=s,a.bundle=t.createSwappableBuffer(t.canvas.width,t.canvas.height,s),r.deleteShader(o)}r.deleteShader(i)}},{key:"createSwappableBuffer",value:function(e,t,r){var i=this.createBuffer(e,t,r),n=this.createBuffer(e,t,r),a=this.gl;return{input:i,output:n,swap:function(){var e=i;i=n,n=e,this.input=i,this.output=n},render:function(e,t,r,i){a.useProgram(r),a.viewport(0,0,e,t),a.bindFramebuffer(a.FRAMEBUFFER,this.input.buffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.output.texture,0),a.drawArrays(a.TRIANGLES,0,6),this.swap()},resize:function(e,t,r,i){a.useProgram(r),a.viewport(0,0,e,t),this.input.resize(e,t),this.output.resize(e,t)}}}},{key:"createBuffer",value:function(e,t,r){var u=this.gl,l=this.BUFFER_COUNT;this.BUFFER_COUNT+=2,u.getExtension("OES_texture_float");var h=u.createTexture();u.activeTexture(u.TEXTURE0+l),u.bindTexture(u.TEXTURE_2D,h),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,e,t,0,u.RGBA,u.FLOAT,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);var f=u.createFramebuffer();return{index:l,texture:h,buffer:f,W:e,H:t,resize:function(e,t){u.bindFramebuffer(u.FRAMEBUFFER,f);var r=Math.min(e,this.W),i=Math.min(t,this.H),n=new Float32Array(r*i*4);u.readPixels(0,0,r,i,u.RGBA,u.FLOAT,n),u.bindFramebuffer(u.FRAMEBUFFER,null);var a=l+1,o=u.createTexture();u.activeTexture(u.TEXTURE0+a),u.bindTexture(u.TEXTURE_2D,o),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,e,t,0,u.RGBA,u.FLOAT,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,r,i,u.RGBA,u.FLOAT,n);var s=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,null),u.deleteTexture(h),u.activeTexture(u.TEXTURE0+l),u.bindTexture(u.TEXTURE_2D,o),l=this.index=l,h=this.texture=o,f=this.buffer=s,this.W=e,this.H=t}}}},{key:"resizeSwappableBuffers",value:function(){var e=this.gl,t=e.canvas.width,r=e.canvas.height;for(var i in e.viewport(0,0,t,r),this.buffers){var n=this.buffers[i];n.bundle.resize(t,r,n.program,n.name)}e.useProgram(this.program)}},{key:"version",value:function(){return"0.1.7"}}]),d}();return window.addEventListener("load",function(){!function(){var e=document.getElementsByClassName("glslCanvas");if(0<e.length){window.glslCanvases=[];for(var t=0;t<e.length;t++){var r=new D(e[t]);r.isValid&&window.glslCanvases.push(r)}}}()}),D},"object"===M(n)&&void 0!==i?i.exports=r():void 0===(t="function"==typeof(e=r)?e.call(n,a,n,i):e)||(i.exports=t),window.GlslCanvas=r()}).call(this,a(1))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r}]);